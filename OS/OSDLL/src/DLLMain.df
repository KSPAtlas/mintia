#include "<df>/dragonfruit.h"

#include "<inc>/OSCalls.h"
#include "<inc>/OSMap.h"
#include "<inc>/OSFile.h"
#include "<inc>/OSPEB.h"

fn DLLMain { -- }
	// initialize the process image by mapping its sections into the address
	// space and dynamically linking it if necessary.

	// SystemInit.exe is a special case where no image file name is given in
	// the PEB.

	auto processimagename
	OSPEB OSPEBs_ImagePath + processimagename!

	if (processimagename@ gb ~~)
		// this is SystemInit.exe

		OSPEB OSPEBs_ImagePath + // dest
		"SystemInit.exe" // src
		strcpy

		-1 OSPEB OSPEBs_StdIn + !
		-1 OSStdIn!

		-1 OSPEB OSPEBs_StdOut + !
		-1 OSStdOut!

		-1 OSPEB OSPEBs_StdErr + !
		-1 OSStdErr!
	end

	while (1) end
end